{% extends 'shop/base.html' %}
{% load static %}
{% block title %}{{ product.name }}{% endblock %}

{% block content %}
<div class="row">
  <div class="col-md-6">
  {% if product.image %}
  <img src="{{ product.image.url }}" class="img-fluid" alt="{{ product.name }}">
{% else %}
  <img src="{% static 'shop/products/default_product.png' %}"
       class="img-fluid" alt="{{ product.name }}">
{% endif %}

  </div>

  <div class="col-md-6">
    <h2>{{ product.name }}</h2>
    <p>{{ product.description }}</p>
    <p><strong>R{{ product.price }}</strong></p>
    {% if user.is_authenticated and user.is_buyer %}
      <a href="{% url 'add_to_cart' product.pk %}" class="btn btn-success">Add to Cart</a>
    {% endif %}
  </div>
</div>

<hr>
<h4>Reviews</h4>
{% for r in product.reviews.all %}
  <div class="mb-3 border-bottom pb-2">
    <strong>{{ r.rating }}/5</strong> - {{ r.title }}
    {% if r.verified %}
      <span class="badge bg-success">Verified</span>
    {% endif %}
    <p>{{ r.body }}</p>
  </div>
{% empty %}
  <p>No reviews yet.</p>
{% endfor %}

{% if user.is_authenticated and user.is_buyer %}
  <h5>Leave a Review</h5>
  <form method="post" action="{% url 'add_review' product.pk %}">
    {% csrf_token %}
    {{ review_form.as_p }}
    <button class="btn btn-primary">Submit</button>
  </form>
{% endif %}
{% endblock %}
